define("wkview:widget/raw_income/raw_income.js",function(e,t,n){function a(e){this.options=e||{},this.step2Tmpl=o.template('<div class="WkDownload-activity">\n<div class="dialog-ad dialog-ad-nomarl">\n<div class="donwload-activity-dialog-container">\n<div class="myclose"></div>\n<div class="income-close-btn verify-close-btn" data-fun="close-dialog"></div>\n<div class="dialog-left-greenbar"></div>\n<div class="dialog-top">\n<p class="doc-title" rel="new-dialog" alt="dialog_tit">{{=it.tmpdata.step2.title}}</p>\n</div>\n<div class="dialog-inner tac">\n<div id="giftform">\n{{~it.tmpdata.step2.collectList:value:index}}<div class="formgroup {{=value.className}}">\n{{? value.type == \'options\'}}<div class="ui-bz-select"><p class="ui-bz-select-word" data-fun="select">{{=value.title}}</p>\n<ul class="ui-bz-select-option">\n{{~value.list:valuelist:indexlist}}<li><a href="javascript:;" data-fun="choice" data-value="{{=valuelist.value}}">{{=valuelist.value}}</span></a></li>\n{{~}}</ul>\n<input type="text" name="{{=value.name}}" class="ipt-hide">\n</div>\n{{??}}<input type="text" placeholder="{{=value.title}}" name="{{=value.name}}" class="txt_usname fixplaceholder"/>\n{{?}}</div>\n{{~}}<div class="formgroup">\n<input class="ui-bz-ipt ui-bz-ipt-bgw fixplaceholder" type="text" placeholder="\u8bf7\u586b\u5199\u624b\u673a\u53f7\u7801" name="phone" autocomplete="off">\n<div class="sug phone-sug"></div>\n<span class="errorinfo">\u8bf7\u586b\u5199\u6b63\u786e\u7684\u624b\u673a\u53f7</span>\n</div>\n<div class="formgroup" style="display: none;">\n<div class="tel-wrap">\n<input class="ui-bz-ipt ui-bz-ipt-bgw fixplaceholder" type="text" placeholder="\u8bf7\u586b\u5199\u624b\u673a\u9a8c\u8bc1\u7801" name="phone_vcode" style="width: 139px;">\n<a href="javascript:;" class="ui-bz-btn-normal ui-bz-btn-51offer">\n<b class="ui-bz-btn-p-15 ui-bz-btc" data-fun="get-smsg">\u83b7\u53d6\u77ed\u4fe1\u9a8c\u8bc1\u7801</b>\n</a>\n</div>\n<span class="errorinfo" id="telerror">\u8bf7\u586b\u5199\u6b63\u786e\u624b\u673a\u9a8c\u8bc1\u7801</span>\n</div>\n<div class="formgroup form-err-group">\n<span class="errorinfo"></span>\n</div>\n</div>\n{{? it.index == 3}}<div class="public-tip public-tip-v2">\n{{=it.tmpdata.advertiser_step2.before}}<span class="name">{{=it.tmpdata.advertiser_step2.name}}</span>\n{{=it.tmpdata.advertiser_step2.after}}<span class="private">\n&nbsp;\u9690\u79c1\u4fdd\u969c<div class="hover-tip-hujiang">\n<span class="arrow-icon"></span>\n{{=it.tmpdata.privacy_policy}}</div>\n</span>\n</div>\n<a href="javascript:;" class="ui-bz-btn-senior btn-diaolog-downdoc"><b class="ui-bz-btn-p-16 ui-bz-btc" data-fun="submit-info">\u514d\u8d39\u9884\u7ea6</b></a>\n{{?}}                {{? it.index == 1}}<a href="javascript:;" class="ui-bz-btn-senior btn-diaolog-downdoc"><b class="ui-bz-btn-p-16 ui-bz-btc" data-fun="submit-info">\u514d\u8d39\u4e0b\u8f7d</b></a>\n<div class="public-tip">\n{{=it.tmpdata.advertiser}}<span class="private">\n&nbsp;\u9690\u79c1\u4fdd\u969c<div class="hover-tip-hujiang">\n<span class="arrow-icon"></span>\n{{=it.tmpdata.privacy_policy}}</div>\n</span>\n</div>\n{{?}}</div>\n</div>\n</div>\n</div>\n<div class="WkDownload-activity-iframe">\n<iframe allowTransparency="true" src="" frameborder="0" scrolling="no"></iframe>\n</div>\n'),this.init()}var i=e("wkcommon:widget/ui/lib/jquery/jquery.js"),o=e("wkcommon:widget/lib/doT/doT.min.js"),r=e("wkcommon:widget/lib/tangram/base/base.js"),s=e("wkcommon:widget/ui/js_core/log/log.js"),l=(e("wkcommon:widget/ui/js_core/dialog/dialog.js"),e("wkcommon:widget/ui/js_core/_dialog/_dialog.js"));a.prototype={init:function(){var e=this;e.addEventListener()},getHTML:function(e){var t="step"+(e||2)+"Tmpl";return this[t]({type:e||0,activity_id:this.activity_id})},closeDialog:function(e){var t=this;i(".WkDownload-activity, .WkDownload-activity-iframe").remove(),"function"==typeof e&&e(t)},showDialog:function(){var e=this,t=(i(window).height(),l.customDialog);new t({width:481,content:e.step2Tmpl({index:e.options.index,tmpdata:e.options}),closeSelector:".myclose",mask:{bgColor:"transparent"}}),e.placeholder()},getPhoneMsg:function(e){i.get("/org/interface/getphone?&t="+Math.random(),function(e){0===e.errno&&e.data.securemobil&&!e.data.is_same&&i(".phone-sug").html(e.data.securemobil)})},addEventListener:function(){var e=this;i("body").on("click",".dialog-ad",function(t){var n=i(t.target),a=n.attr("data-fun");switch(a){case"submit-info":var o={},r=e.getFormData();if(o.phone=r.phone,o.pid=79,o.phone_vcode=r.phone_vcode,delete r.phone_vcode,o.clues_data=r,o.ad_id=e.options.adId,!e.checkData(o))return;i(".form-err-group").removeClass("err"),i.post("/xpage/interface/addclues",o,function(t){var a=t.status.code,o={code0:"\u6210\u529f",code1:"\u53c2\u6570\u9519\u8bef",code2:"\u9a8c\u8bc1\u7801\u9519\u8bef",code3:"\u8be5\u624b\u673a\u53f7\u5df2\u7ecf\u63d0\u4ea4\u8fc7",code4:"\u7cfb\u7edf\u9519\u8bef"};if(0===a||3===a){n.attr("data-fun",""),e.options.step2.download_url&&e.godownload(e.options.step2.download_url);var r=setTimeout(function(){clearTimeout(r),e.gonext()},1e3)}else a="code"+a,i(".form-err-group .errorinfo").html(o[a]||"\u7cfb\u7edf\u7e41\u5fd9, \u8bf7\u7a0d\u540e\u91cd\u8bd5"),i(".form-err-group").addClass("err")});break;case"get-smsg":var s=i(".dialog-ad input[name=phone]");if(!e.isTel(s.val()))return void s.css("border-color","red").siblings(".errorinfo").css("display","block");n.parent().addClass("ui-bz-btn-disable"),n.attr("data-fun","");var l="\u79d2\u540e\u91cd\u53d1",d=120,c="/xpage/interface/getphonevcode?phone="+s.val()+"&t="+Math.random();i.get(c,function(t){var a=+t.status.code,o={code0:"\u6210\u529f",code11:"\u624b\u673a\u9a8c\u8bc1\u7801\u53d1\u9001\u8fc7\u4e8e\u9891\u7e41",code31:"\u624b\u673a\u9a8c\u8bc1\u7801\u672a\u4f20\u5165",code32:"\u64cd\u4f5c\u8fc7\u4e8e\u9891\u7e41\uff0c\u8bf7\u7a0d\u5019\u518d\u8bd5",code5:"\u64cd\u4f5c\u5931\u8d25 \u8bf7\u7a0d\u540e\u91cd\u8bd5"};if(a){a="code"+a,i("#telerror").html(o[a]),e.showErr("phone_vcode");var r=setInterval(function(){clearInterval(r),n.parent().removeClass("ui-bz-btn-disable"),n.text("\u83b7\u53d6\u77ed\u4fe1\u9a8c\u8bc1\u7801").attr("data-fun","get-smsg")},3e3)}else var s=setInterval(function(){d?(n.text(d+l),d--):(clearInterval(s),n.parent().removeClass("ui-bz-btn-disable"),n.text("\u83b7\u53d6\u77ed\u4fe1\u9a8c\u8bc1\u7801").attr("data-fun","get-smsg"))},1e3)});break;case"choice":var p=n.attr("data-value"),u=n.text(),v=n.parents(".ui-bz-select");v.find(".ui-bz-select-word").text(u),v.find(".ipt-hide").val(p),v.find(".ui-bz-select-option").hide(),e.rmErr(v.find(".ipt-hide").attr("name"))}}),i("body").on("blur","input[name=phone]",function(){var t=i(this),n=t.val();return e.rmErr("phone"),e.isTel(n)?void 0:void e.showErr("phone")}),i("body").on("blur","input[name=phone_vcode]",function(){var t=i(this).val();e.rmErr("phone_vcode"),i.trim(t)||(i("#telerror").html("\u9a8c\u8bc1\u7801\u4e3a\u7a7a"),e.showErr("phone_vcode"))}),i("body").on("keyup blur change",".dialog-ad .ic-name",function(){i.trim(i(this).val())?e.rmErr("name"):e.showErr("name")}),i("body").on("keyup blur change",".dialog-ad input[name=phone]",function(t){t.preventDefault();var n=i(this).val(),a=i(".phone-sug").html(),o=new RegExp("^"+n);return n===a?(i(".phone-sug").hide(),void i(".tel-wrap").parent().hide()):(e.isTel(n)&&n!==a&&i(".tel-wrap").parent().show(),n?void(o.test(a)?i(".phone-sug").show():i(".phone-sug").hide()):void i(".phone-sug").hide())}),i("body").on("click",".verify-close-btn",function(){i(".myclose").trigger("click"),i(".ys-ads-mask").hide()}),i("body").on("click",".phone-sug",function(){i(".dialog-ad input[name=phone]").val(i(this).html()),i(".dialog-ad input[name=phone]").trigger("blur"),i(this).hide()}),i("body").on("focus","#giftform input",function(){i(".form-err-group").removeClass("err")}),i("body").on("mouseover",".formgroup .ui-bz-select",function(){i(this).find(".ui-bz-select-option").show()}),i("body").on("mouseleave",".formgroup .ui-bz-select",function(){i(this).find(".ui-bz-select-option").hide()})},cancleEvent:function(){i("body").off("click",".phone-sug"),i("body").off("click",".verify-close-btn"),i("body").off("keyup blur change",".dialog-ad input[name=phone]"),i("body").off("blur","input[name=phone_vcode]"),i("body").off("blur","input[name=phone]"),i("body").off("click",".dialog-ad")},getFormData:function(){var e=i("#giftform").find(":input").serializeArray();return this.serialize2obj(e)},serialize2obj:function(e){for(var t={},n=0;n<e.length;n++)t[e[n].name]=encodeURIComponent(e[n].value);return t},checkData:function(e){var t=this,n=[];return t.isTel(e.phone)||(t.showErr("phone"),n.push("phone")),n.length?(t.showErr(n),!1):!0},gonext:function(){var e=this;s.xsend(1,100896,{id:e.options.ad_id}),i(".myclose").trigger("click"),new l.customDialog({width:465,height:230,content:e.options.downloadTpl({list:0,tmpdata:e.options}),closeSelector:".myclose",mask:{bgColor:"transparent"}})},godownload:function(e){var t='<iframe allowTransparency="true" src="'+e+'" frameborder="0" scrolling="no"></iframe>';i("body").append(t)},isTel:function(e){return!!e.match(/^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/)},placeholder:function(){+r.browser.ie<=9&&i(".fixplaceholder").each(function(e,t){var n=i(t).attr("placeholder");i(t).val(n).click(function(){i(this).val()===n&&i(this).val("")}).blur(function(){var e=i(this).val();i.trim(e)||i(this).val(n)})})},showErr:function(e){var t=typeof e;if("string"===t)i("input[name="+e+"]").parents(".formgroup").addClass("err");else if("object"===t)for(var n=e.length-1;n>=0;n--)i("input[name="+e[n]+"]").parents(".formgroup").addClass("err")},rmErr:function(e){var t=typeof e;if("string"===t)i("input[name="+e+"]").parents(".formgroup").removeClass("err");else if("array"===t)for(var n=e.length-1;n>=0;n--)i("input[name="+e[n]+"]").parents(".formgroup").removeClass("err")}},n.exports=a});