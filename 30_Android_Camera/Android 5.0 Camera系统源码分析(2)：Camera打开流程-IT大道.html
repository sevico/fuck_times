<!DOCTYPE html>
<!-- saved from url=(0049)http://www.itdadao.com/articles/c15a674054p0.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<style id="znBdcsStyle" type="text/css">.bdcs-container .bdcs-main,.bdcs-container .bdcs-main *{box-sizing:content-box;margin:0;padding:0;float:none;clear:none;overflow:hidden;white-space:nowrap;word-wrap:normal;border:0;background:0 0;width:auto;height:auto;max-width:none;min-width:none;max-height:none;min-height:none;border-radius:0;box-shadow:none;transition:none;text-align:left}.bdcs-container .bdcs-clearfix:after{content:'';display:block;clear:both;height:0}.bdcs-container .bdcs-clearfix{zoom:1}.bdcs-container .bdcs-main{overflow:visible}.bdcs-container .bdcs-search{display:block;overflow:visible;position:relative;border-style:solid}.bdcs-container .bdcs-search-form-input-wrap{display:inline-block}.bdcs-container .bdcs-search-form-input{border-width:1px;border-style:solid;display:inline-block;vertical-align:top;text-indent:5px;background-color:#fff;float:left}.bdcs-container .bdcs-search-form-input:focus{border-width:1px;border-style:solid;outline:0}.bdcs-container .bdcs-search-form-submit-wrap{display:inline-block}.bdcs-container .bdcs-search-form-submit{display:inline-block;cursor:pointer;border-width:1px;border-style:solid;vertical-align:top;text-align:center;width:50px;//_overflow:hidden}.bdcs-container .bdcs-search-form-submit-magnifier{width:45px;padding:0;text-indent:-999em;overflow:hidden;background:url(http://znsv.baidu.com/static/customer-search/component/search/magnifier-icon.png) no-repeat center center;_background:url(http://znsv.baidu.com/static/customer-search/component/search/magnifier-icon_ie6.png) no-repeat center center}div#default-searchbox .default-channel-meun{position:relative;width:75px;display:inline-block;vertical-align:middle;cursor:pointer;background:#fff;float:left;overflow:visible}div#default-searchbox .default-channel-current{border:1px solid;position:relative;width:100%;border-right:0}div#default-searchbox .default-channel-current span{margin-left:8px}div#default-searchbox .default-channel-current i{overflow:hidden;width:0;height:0;border-width:6px 6px 0;border-color:#9E9E9E #fff;border-style:solid;display:block;position:absolute;right:10px;top:11px}div.cse-default-channel-container{display:block;position:absolute;z-index:30061000000}div.cse-default-channel-container .default-channel-list{display:none;width:99%;list-style:none;background:#fff;border:1px solid #DDD;border-top:0;margin:0;padding:0}div.cse-default-channel-container .default-channel-list li{background:0 0;line-height:24px;list-style:none;display:block;padding-left:7px;cursor:pointer}div.cse-default-channel-container .default-channel-list li:hover{background:#DDD}.bdcs-container .bdcs-search-form-input-wrap{}.bdcs-container .bdcs-search-form-input-notspan{margin-left:0px;font-family:Arial,SimSun,sans-serif;color:#000000;font-size:14px;}.bdcs-container .bdcs-search-form-input .icon-nofocus{left:;right:;top:;height:;width:;}.bdcs-container .bdcs-search{width:299px;height:48px;overflow:hidden;border-color:#55AA00;border-radius:5px;border-width:2px;box-shadow:none;background-color:#55AA00;}.bdcs-container .bdcs-search-form-input{border-color:#55AA00;margin-right:0px;width:246px;height:46px;line-height:46px;font-family:Arial,SimSun,sans-serif;color:#000000;font-size:14px;border-radius:1px;background-color:#FFFFFF;}.bdcs-container .bdcs-search-form-input:focus{border-color:#f79646;}.bdcs-container .bdcs-search-form-submit-wrap{}.bdcs-container .bdcs-search-form-submit{border-color:#55AA00;height:46px;width:50px;background-color:#55AA00;color:#ffffff;font-family:Arial,SimSun,sans-serif;font-size:14px;border-radius:0px;}.bdcs-container .bdcs-search-sug-list{width:px;}.bdcs-container .bdcs-search-sug-list-item{height:28px;line-height:28px;font-family:Arial,SimSun,sans-serif;font-size:14px;}.bdcs-container .bdcs-search-sug-list-item-value{color:#000000;}.bdcs-container .bdcs-hot{width:300px;height:30px;line-height:30px;}.bdcs-container .bdcs-hot-item{color:#000000;font-family:Arial,Microsoft YaHei,sans-serif;font-size:14px;}.bdcs-container .bdcs-clearfix:after{content:'';display:block;clear:both;height:0}.bdcs-container .bdcs-clearfix{zoom:1}.bdcs-container .bdcs-search{overflow:visible;position:relative}.bdcs-container .bdcs-search-sug,.bdcs-container .bdcs-search-sug *{box-sizing:content-box;margin:0;padding:0;float:none;clear:none;overflow:hidden;white-space:nowrap;word-wrap:normal;border:0;background:0 0;width:auto;height:auto;max-width:none;min-width:none;max-height:none;min-height:none;border-radius:0;box-shadow:none;transition:none;text-align:left}.bdcs-container .bdcs-search-sug{display:none;position:absolute;z-index:2147483647}.bdcs-container .bdcs-search-sug-list{list-style:none;border:1px solid #DDD;background-color:#FFF}.bdcs-container .bdcs-search-sug-list{}.bdcs-container .bdcs-search-sug-list-item{display:block;list-style:none;cursor:pointer;padding:0 5px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.bdcs-container .bdcs-search-sug-list-item-current{background-color:#EBEBEB}.bdcs-container .bdcs-search-sug-list-item-author-novel,.bdcs-container .bdcs-search-sug-list-item-author-music,.bdcs-container .bdcs-search-sug-list-item-type-movie{color:#BABABA}.bdcs-container .bdcs-search-sug-list-item-author-novel,.bdcs-container .bdcs-search-sug-list-item-author-music{margin-left:5px}.bdcs-container .bdcs-search-sug-list-item-music{overflow:hidden;*zoom:1}.bdcs-container .bdcs-search-sug-list-item-value-movie{float:left}.bdcs-container .bdcs-search-sug-list-item-type-movie{float:right}.bdcs-container .bdcs-search-sug-skin{display:none;width:85px;height:85px;position:absolute;right:1px;bottom:1px}.bdcs-container .bdcs-search-sug-skin-img{width:85px;height:85px}.bdcs-container .bdcs-search-sug-i{color:#e64fa3;font-weight:700;margin-left:10px;font-family:simsun;font-style:normal}.bdcs-container .bdcs-search-sug-adv{width:105px;position:absolute;right:1px;top:1px;display:none}.bdcs-container .bdcs-search-sug-adv-img{position:absolute;top:0;right:0}.bdcs-container{overflow:visible;}.bdcs-container .bdcs-search-form-submit{*height:48px;*margin-top:1px;}.bdcs-container .bdcs-search-form-submit{line-height:46px;}.bdcs-container .bdcs-search-form-input{margin-right:-1px;}.bdcs-container .bdcs-search-sug-list-item{height:28px;line-height:28px;font-family:Arial,SimSun,sans-serif;font-size:14px;}.bdcs-container .bdcs-search-sug-list-item-value{color:#000000;}.bdcs-container .bdcs-clearfix:after{content:'';display:block;clear:both;height:0}.bdcs-container .bdcs-clearfix{zoom:1}.bdcs-container .bdcs-hot,.bdcs-container .bdcs-hot *{box-sizing:content-box;margin:0;padding:0;float:none;clear:none;overflow:hidden;white-space:nowrap;word-wrap:normal;border:0;background:0 0;width:auto;height:auto;max-width:none;min-width:none;max-height:none;min-height:none;border-radius:0;box-shadow:none;transition:none;text-align:left}.bdcs-container .bdcs-hot{display:block;white-space:normal}.bdcs-container .bdcs-hot-item{margin-right:10px}.bdcs-container .bdcs-hot{width:300px;height:30px;line-height:30px;}.bdcs-container .bdcs-hot-item{color:#000000;font-family:Arial,Microsoft YaHei,sans-serif;font-size:14px;}#bdcs-rec{display:none;}</style><meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0">

<meta http-equiv="Content-Language" content="zh-CN">
<meta name="keywords" content="MTK,android,camera,源码分析,调用流程,">
<meta name="description" content="Android 5.0 Camera系统源码分析(2)：Camera打开流程 ">
<title>Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道</title>
<link rel="stylesheet" rev="stylesheet" href="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/style.css" type="text/css" media="all">
<link rel="stylesheet" rev="stylesheet" href="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/font-awesome.min.css" type="text/css" media="all">
<script async="" src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/analytics.js.下载"></script><script src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/hm.js.下载"></script><script type="text/javascript" async="" src="https://cse.google.com/cse.js?cx=004183402591912962009:uah3-aabtfg"></script><script src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/ca-pub-8722128765990495.js.下载"></script><script src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/ca-pub-8722128765990495.js.下载"></script><script src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/ca-pub-8722128765990495.js.下载"></script><script type="text/javascript" async="" src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/js"></script><script src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/common.js.下载" type="text/javascript"></script>
<script src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/jquery.bxslider.min.js.下载" type="text/javascript"></script>
<script src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/jquery.SuperSlide.2.1.1.js.下载" type="text/javascript"></script>
<script src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/ecms084.js.下载" type="text/javascript"></script>
<script src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/share.js.下载"></script><script type="text/javascript" src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/pre"></script><script type="text/javascript" async="" src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/embed.js.下载" charset="UTF-8"></script><script src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/wgxpath.install.js.下载" charset="utf-8" async=""></script><link rel="stylesheet" href="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/share_style1_24.css"><link rel="stylesheet" href="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/share_popup.css"><link rel="stylesheet" href="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/select_share.css"><link rel="stylesheet" href="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/imgshare.css"><link rel="stylesheet" href="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/share_style0_16.css"></head>

<body>
<script async="" src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/adsbygoogle.js.下载"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-8722128765990495",
    enable_page_level_ads: true
  });
</script>
<div class="top sjwu">
  <div class="zh">IT大道<span class="fr"><a href="http://www.itdadao.com/" title="IT大道" target="_blank">IT大道</a></span></div>
</div>
<div class="sjwu head">
  <div class="zh">
    <h1 class="logo fl"><a href="http://www.itdadao.com/" title="IT大道"></a></h1>
    <span class="ss fl">
   <script type="text/javascript">(function(){document.write(unescape('%3Cdiv id="bdcs"%3E%3C/div%3E'));var bdcs = document.createElement('script');bdcs.type = 'text/javascript';bdcs.async = true;bdcs.src = 'http://znsv.baidu.com/customer_search/api/js?sid=12630636344295055440' + '&plate_url=' + encodeURIComponent(window.location.href) + '&t=' + Math.ceil(new Date()/3600000);var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(bdcs, s);})();</script><div id="bdcs"><div class="bdcs-container"><meta http-equiv="x-ua-compatible" content="IE=9">   <!-- 嵌入式 -->  <div class="bdcs-main bdcs-clearfix" id="default-searchbox">      <div class="bdcs-search bdcs-clearfix" id="bdcs-search-inline">          <form action="http://zhannei.baidu.com/cse/search" method="get" target="_blank" class="bdcs-search-form" autocomplete="off" id="bdcs-search-form">              <input type="hidden" name="s" value="12630636344295055440">              <input type="hidden" name="entry" value="1">                                                                        <input type="text" name="q" class="bdcs-search-form-input" id="bdcs-search-form-input" placeholder="请输入关键词" autocomplete="off" style="height: 46px; line-height: 46px;">              <input type="submit" class="bdcs-search-form-submit " id="bdcs-search-form-submit" value="搜索">                       </form>      </div>                <div class="bdcs-search-sug" id="bdcs-search-sug" style="top: 96px; left: 533px; width: 247px;">              <ul class="bdcs-search-sug-list" id="bdcs-search-sug-list"></ul>          </div>                     <div class="bdcs-hot" id="bdcs-hot">               </div>       </div>                           </div></div>
</span>
    <span class="rss fr">
    <script src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/thea1.js.下载"></script><script async="" src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/adsbygoogle.js.下载"></script><ins class="adsbygoogle" style="display:inline-block;width:468px;height:15px" data-ad-client="ca-pub-8722128765990495" data-ad-slot="6082825422" data-adsbygoogle-status="done"><ins id="aswift_1_expand" style="display:inline-table;border:none;height:15px;margin:0;padding:0;position:relative;visibility:visible;width:468px;background-color:transparent"><ins id="aswift_1_anchor" style="display:block;border:none;height:15px;margin:0;padding:0;position:relative;visibility:visible;width:468px;background-color:transparent"><iframe width="468" height="15" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_1" name="aswift_1" style="left:0;position:absolute;top:0;width:468px;height:15px;" src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/saved_resource.html"></iframe></ins></ins></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
    </span>
    <div class="clear"></div>
  </div>
</div>
<div class="clearfix mb15" id="nav" data-type="index" data-infoid=" "> <a href="http://www.itdadao.com/" class="home"><i class="fa fa-home"></i></a>
  <ul class="clearfix zh">
    <li><a class="" href="http://www.itdadao.com/">首页</a></li>
      <li><a class="current-menu-item" href="http://www.itdadao.com/category/c15p0.html"> 技术</a></li><li><a class="" href="http://www.itdadao.com/category/c18p0.html">新闻</a></li><li><a class="" href="http://www.itdadao.com/category/c19p0.html">源码</a></li><li><a class="" href="http://www.itdadao.com/category/c20p0.html">设计</a></li><li><a class="" href="http://www.itdadao.com/category/c21p0.html">创业</a></li><li><a class="" href="http://www.itdadao.com/category/c22p0.html">营销</a></li>  </ul>
  <a href="http://www.itdadao.com/articles/c15a674054p0.html#" id="pull"><i class="fa fa-bars"></i></a> </div>
<div class="h60"></div>
<div class="ad zh mb15 sjwu">
  <script src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/thea11.js.下载"></script>
</div>
<div class="ad zh mb15 dnwu">
  <script async="" src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/adsbygoogle.js.下载"></script>
<ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8722128765990495" data-ad-slot="3450871422" data-ad-format="auto" data-adsbygoogle-status="done"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div>
<div class="main zh">
  <div class="left fl mb15">
    <div class="info bgb">
      <h2 class="ybbt1"><i class="fa fa-home"></i> <a href="http://www.itdadao.com/">首页</a>&nbsp;&gt;&nbsp;<a href="http://www.itdadao.com/category/c15p0.html"> 技术</a> &gt; Android 5.0 Camera系统源码分析(2)：Camera打开流程 </h2>
      <div class="info-bt">
        <h1 class="title">Android 5.0 Camera系统源码分析(2)：Camera打开流程</h1>
        <small><span><i class="fa fa-folder"></i>原文 <a href="http://blog.csdn.net/eternity9255/article/details/52126392?utm_source=itdadao&amp;utm_medium=referral" rel="nofollow,noindex" target="_blank" style="display:inline-block;">http://blog.csdn.net/eternity9255/article/details/52126392</a></span></small>
        <small><span><i class="fa fa-clock-o"></i> 2016-10-30 09:38:01 </span><span><i class="fa fa-eye"></i> <script src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/saved_resource"></script>426 ℃</span><span><i class="fa fa-comments-o"></i> <a href="http://www.itdadao.com/articles/c15a674054p0.html#comment" title="欢迎你对本文发表看法" class="ds-thread-count" data-thread-key="674054">0 评论</a></span></small>
	</div>
      <div class="ad mb15 sjwu">
        <script src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/thea17.js.下载"></script><script async="" src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/adsbygoogle.js.下载"></script><ins class="adsbygoogle" style="display:inline-block;width:728px;height:90px" data-ad-client="ca-pub-8722128765990495" data-ad-slot="9159012222" data-adsbygoogle-status="done"><ins id="aswift_2_expand" style="display:inline-table;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:728px;background-color:transparent"><ins id="aswift_2_anchor" style="display:block;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:728px;background-color:transparent"><iframe width="728" height="90" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_2" name="aswift_2" style="left:0;position:absolute;top:0;width:728px;height:90px;" src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/saved_resource(1).html"></iframe></ins></ins></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
      </div>
      <div class="ad mb15 dnwu">
        <script async="" src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/adsbygoogle.js.下载"></script>
<ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8722128765990495" data-ad-slot="3450871422" data-ad-format="auto" data-adsbygoogle-status="done"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>      </div>
      <div class="info-zi mb15">
        <h1>1. 前言</h1>
<p>本文将分析android系统源码，从frameworks层到hal层，暂不涉及app层和kernel层。由于某些函数比较复杂，在贴出代码时会适当对其进行简化。本文属于自己对源码的总结，仅仅是贯穿代码流程，不会深入分析各个细节。欢迎联系讨论，QQ：1026656828</p>
<h1>2. app层</h1>
<p>从apk开始，简单列出各个入口函数</p>

<pre>private void initCamera()
{
    Camera mCamera = Camera.open();
    Camera.Parameters mParameters = mCamera.getParameters();
    mParameters.setPictureFormat(PixelFormat.JPEG);
    mCamera.setParameters(mParameters);
    mCamera.setPreviewDisplay(mSurfaceHolder);
    mCamera.startPreview();
    mCamera.takePicture(null, null , mJpegCallback);
}</pre>
<h1>3. frameworks层</h1>
这里将重点介绍Camera.open函数，其余函数将在后续博文分析。先来看看Camera.open函数在frameworks层的实现，代码路径为:&nbsp;frameworks/base/core/java/android/hardware/Camera.java


<pre>public static Camera open() {
    if (!isPermissionGranted()) {
        return null;
    }    
    int numberOfCameras = getNumberOfCameras();
    CameraInfo cameraInfo = new CameraInfo();
    for (int i = 0; i &lt; numberOfCameras; i++) {
        getCameraInfo(i, cameraInfo);
        if (cameraInfo.facing == CameraInfo.CAMERA_FACING_BACK) {
            return new Camera(i);
        }    
    }    
    return null;
}    </pre>第5行, 通过getNumberOfCameras函数来获取Camera的个数。从上一篇博文<a href="http://blog.csdn.net/shell812/article/details/49424857" rel="nofollow,noindex" target="_blank">CameraService的启动流程</a>可以看出，这个信息保存在CameraService中。<br>
第10行，需重点关注，构造一个Camera对象，并将它返回给app层。<br>
<h3>3.1&nbsp;getNumberOfCameras函数分析</h3>
getNumberOfCameras函数进入到CameraService获取Camera个数的流程如下:<br>

<p><img src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/cd322651300937331.png" alt="" data-bd-imgshare-binded="1"><br>
</p>
<p>Camera.java调用的getNumberOfCameras函数是一个JNI接口，对应的函数是android_hardware_Camera.cpp里的android_hardware_Camera_getNumberOfCameras函数</p>

<pre>static jint android_hardware_Camera_getNumberOfCameras(JNIEnv *env, jobject thiz)
{
    return Camera::getNumberOfCameras();
}</pre>这里只是简单调用了Camera.cpp的getNumberOfCameras函数，Camera继承了CameraBase，该函数由它实现


<pre>template &lt;typename TCam, typename TCamTraits&gt;
int CameraBase&lt;TCam, TCamTraits&gt;::getNumberOfCameras() {
    const sp&lt;ICameraService&gt; cs = getCameraService();
    return cs-&gt;getNumberOfCameras();
}</pre>第3行, getCameraService函数用来获取ICameraService的Bp端，代码实现如下<br>
<pre>const char* kCameraServiceName = "media.camera";

template &lt;typename TCam, typename TCamTraits&gt;
const sp&lt;ICameraService&gt;&amp; CameraBase&lt;TCam, TCamTraits&gt;::getCameraService()
{   
    if (gCameraService.get() == 0) {
        sp&lt;IServiceManager&gt; sm = defaultServiceManager();
        sp&lt;IBinder&gt; binder;
        binder = sm-&gt;getService(String16(kCameraServiceName));       
        gCameraService = interface_cast&lt;ICameraService&gt;(binder);
    }
    return gCameraService;
}</pre>
<p>Android的Binder通讯机制</p>
<p>第1行,&nbsp;获取的ServiceName为"media.camera"，结合上一篇博文<a href="http://blog.csdn.net/shell812/article/details/49424857" rel="nofollow,noindex" target="_blank">CameraService的启动流程</a>可以看出Bn端的实现在CameraService.cpp</p>
<p>回到之前的getNumberOfCameras函数，在获取到ICameraService的Bp端后，就可以开始和Bn端通讯了。在第4行，当调用cs-&gt;getNumberOfCameras函数时，将会进入CameraService.cpp的getNumberOfCameras函数</p>

<pre>int32_t CameraService::getNumberOfCameras() {
    return mNumberOfCameras;
}</pre>代码很简单，返回上一篇博文讲到的，千辛万苦从hal层拿到的数据


<h3>3.2 Camera构造函数分析</h3>
回到最开始的Camera.open函数，在第10行，将会构造一个Camera对象


<pre>private int cameraInitVersion(int cameraId, int halVersion) {
    ......
    Looper looper;
    if ((looper = Looper.myLooper()) != null) {
        mEventHandler = new EventHandler(this, looper);
    } else if ((looper = Looper.getMainLooper()) != null) {
        mEventHandler = new EventHandler(this, looper);
    } else {
        mEventHandler = null;
    }

    String packageName = ActivityThread.currentPackageName();

    return native_setup(new WeakReference&lt;Camera&gt;(this), cameraId, halVersion, packageName);
}

private int cameraInitNormal(int cameraId) {
    return cameraInitVersion(cameraId, CAMERA_HAL_API_VERSION_NORMAL_CONNECT);
}

Camera(int cameraId) {
    int err = cameraInitNormal(cameraId);
    ......
}</pre>第14行, native_setup同样是个JNI接口，对应android_hardware_Camera.cpp里的android_hardware_Camera_native_setup函数<br>
<pre>static jint android_hardware_Camera_native_setup(JNIEnv *env, jobject thiz,
    jobject weak_this, jint cameraId, jint halVersion, jstring clientPackageName)
{
    camera = Camera::connect(cameraId, clientName, Camera::USE_CALLING_UID);

#if 1 // defined(MTK_CAMERA_BSP_SUPPORT)
    sp&lt;JNICameraContext&gt; context = new MtkJNICameraContext(env, weak_this, clazz, camera);
#else
    sp&lt;JNICameraContext&gt; context = new JNICameraContext(env, weak_this, clazz, camera);
#endif
}</pre>第4行, 调用了Camera.cpp的connect函数，同时返回一个Camera对象，保存在JNICameraContext当中<br>
<pre>sp&lt;Camera&gt; Camera::connect(int cameraId, const String16&amp; clientPackageName,
        int clientUid)
{
    return CameraBaseT::connect(cameraId, clientPackageName, clientUid);
}</pre>
<p>先来看看Camera和CameraBase的类定义</p>
<pre>/* ---------- Camera.h ---------- */
template &lt;&gt;
struct CameraTraits&lt;Camera&gt;
{
    ......
    static TCamConnectService fnConnectService;
};

class Camera : public CameraBase&lt;Camera&gt;
{
    ......
}
/* -------- CameraBase.h -------- */
&lt;pre name="code" class="cpp"&gt;template &lt;typename TCam&gt;
struct CameraTraits {
};

template &lt;typename TCam, typename TCamTraits = CameraTraits&lt;TCam&gt;&gt;
class CameraBase
{
    ......
    typedef CameraBase&lt;TCam&gt;    CameraBaseT;
}</pre>
<pre></pre>
这里使用了C++模版，其实就是调用CameraBase::connect函数<pre>CameraTraits&lt;Camera&gt;::TCamConnectService CameraTraits&lt;Camera&gt;::fnConnectService = &amp;ICameraService::connect;

template &lt;typename TCam, typename TCamTraits&gt;
sp&lt;TCam&gt; CameraBase&lt;TCam, TCamTraits&gt;::connect(int cameraId,
                                               const String16&amp; clientPackageName,
                                               int clientUid)
{
    sp&lt;TCam&gt; c = new TCam(cameraId);
    sp&lt;TCamCallbacks&gt; cl = c;

    const sp&lt;ICameraService&gt;&amp; cs = getCameraService();
    if (cs != 0) {
        TCamConnectService fnConnectService = TCamTraits::fnConnectService;
        status = (cs.get()-&gt;*fnConnectService)(cl, cameraId, clientPackageName, clientUid,
                                             /*out*/ c-&gt;mCamera);
    }

    return c;
}
</pre>
<p>第1行, 将CameraTraits::fnConnectService赋为ICameraService::connect</p>
<p>第7行, 构造一个Camera对象</p>
<p>第10行, 获取ICameraService的Bp端</p>
<p>第13行, 从上面的解释可以看出，实际就是调用CameraService.cpp的connect函数</p>
<p>第17行, 将Camera对象返回给JNI层</p>
<pre>status_t CameraService::connectHelperLocked(
        /*out*/
        sp&lt;Client&gt;&amp; client,
        /*in*/
        const sp&lt;ICameraClient&gt;&amp; cameraClient,
        int cameraId,
        const String16&amp; clientPackageName,
        int clientUid,
        int callingPid,
        int halVersion,
        bool legacyMode) {
    ......
    int deviceVersion = getDeviceVersion(cameraId, &amp;facing);

    switch(deviceVersion) {
        case CAMERA_DEVICE_API_VERSION_1_0:
            client = new CameraClient(this, cameraClient,
                    clientPackageName, cameraId,
                    facing, callingPid, clientUid, getpid(), legacyMode);
            break;
        case CAMERA_DEVICE_API_VERSION_2_0:
        case CAMERA_DEVICE_API_VERSION_2_1:
        case CAMERA_DEVICE_API_VERSION_3_0:
        case CAMERA_DEVICE_API_VERSION_3_1:
        case CAMERA_DEVICE_API_VERSION_3_2:
            client = new Camera2Client(this, cameraClient,
                    clientPackageName, cameraId,
                    facing, callingPid, clientUid, getpid(), legacyMode);
            break;
    }

    status_t status = connectFinishUnsafe(client, client-&gt;getRemote());
    mClient[cameraId] = client;
}

status_t CameraService::connect(
        const sp&lt;ICameraClient&gt;&amp; cameraClient,
        int cameraId,
        const String16&amp; clientPackageName,
        int clientUid,
        /*out*/
        sp&lt;ICamera&gt;&amp; device) {
    ......
    sp&lt;Client&gt; client;
    status = connectHelperLocked(/*out*/client,
                                 cameraClient,
                                 cameraId,
                                 clientPackageName,
                                 clientUid,
                                 callingPid);
    device = client;
    return OK;
}</pre>
<p>忽略细节之后connect函数就只是调用connectHelperLocked函数</p>
<p>第13行, 获取api版本信息，这个函数比较简单，不细说。这里的版本为CAMERA_DEVICE_API_VERSION_1_0</p>
<p>第15-30行, 根据不同的api版本选择构造CameraClient或Camera2Client，这里是CameraClient</p>
第32行, 调用connectFinishUnsafe函数，实现如下<br>

<pre>status_t CameraService::connectFinishUnsafe(const sp&lt;BasicClient&gt;&amp; client,
                                            const sp&lt;IBinder&gt;&amp; remoteCallback) {
    status_t status = client-&gt;initialize(mModule);
}</pre>

这里的client就是上一个函数的CameraClient，mModule就是在上一篇博文<a href="http://blog.csdn.net/shell812/article/details/49424857" rel="nofollow,noindex" target="_blank">CameraService的启动流程</a>里提到的hal层的接口<pre>status_t CameraClient::initialize(camera_module_t *module) {
    mHardware = new CameraHardwareInterface(camera_device_name);
    res = mHardware-&gt;initialize(&amp;module-&gt;common);
    mHardware-&gt;setCallbacks(notifyCallback,
            dataCallback,
            dataCallbackTimestamp,
            (void *)(uintptr_t)mCameraId);
    return OK;
}</pre>构造一个CameraHardwareInterface对象，并调用它的initalize函数，直接看initalize函数<br>
<pre>status_t initialize(hw_module_t *module)
{
    module-&gt;methods-&gt;open(module, mName.string(), (hw_device_t **)&amp;mDevice)
    initHalPreviewWindow();
}</pre>第4行, 从这里进入到了hal层，hal层主要对Camera硬件进行初始化，并将操作集保存在mDevice当中<br>
<h1>4. hal层-基于MTK平台</h1>
<p>hal层对Camera硬件进行初始化以及返回Device操作集的流程如下</p>
<p><img src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/cd322651300937332.png" width="908" height="631" alt="" data-bd-imgshare-binded="1"><br>
</p>
<h3>4.1 open函数分析</h3>

<p>这里再看一次module的定义</p>

<pre>static
hw_module_methods_t*
get_module_methods()
{
    static
    hw_module_methods_t
    _methods =
    {
        open: open_device
    };

    return  &amp;_methods;
}

static
camera_module
get_camera_module()
{
    camera_module module = {
        common:{
             tag                    : HARDWARE_MODULE_TAG,
             #if (PLATFORM_SDK_VERSION &gt;= 21)
             module_api_version     : CAMERA_MODULE_API_VERSION_2_3,
             #else
             module_api_version     : CAMERA_DEVICE_API_VERSION_1_0,
             #endif
             hal_api_version        : HARDWARE_HAL_API_VERSION,
             id                     : CAMERA_HARDWARE_MODULE_ID,
             name                   : "MediaTek Camera Module",
             author                 : "MediaTek",
             methods                : get_module_methods(),
             dso                    : NULL,
             reserved               : {0},
        },
        get_number_of_cameras       : get_number_of_cameras,
        get_camera_info             : get_camera_info,
        set_callbacks               : set_callbacks,
        get_vendor_tag_ops          : get_vendor_tag_ops,
        #if (PLATFORM_SDK_VERSION &gt;= 21)
        open_legacy                 : open_legacy,
        #endif
        reserved                    : {0},
    };
    return  module;
};</pre>
<p>通过module-&gt;methods获取到的函数为open_device，</p>
<pre>static
int
open_device(hw_module_t const* module, const char* name, hw_device_t** device)
{
    return  NSCam::getCamDeviceManager()-&gt;open(device, module, name);
}</pre>CamDeviceManagerImp 继承了 CamDeviceManagerBase。这里直接调用了CamDeviceManagerBase的open()<br>
<pre>status_t
CamDeviceManagerBase::
openDeviceLocked(
    hw_device_t** device,
    hw_module_t const* module,
    int32_t const i4OpenId,
    uint32_t device_version
)
{
    // [2] get platform
    IPlatform*const pPlatform = getPlatform();
    pDevice = pPlatform-&gt;createCam1Device(s8ClientAppMode.string(), i4OpenId);
    *device = const_cast&lt;hw_device_t*&gt;(pDevice-&gt;get_hw_device());
}

status_t
CamDeviceManagerBase::
open(
    hw_device_t** device,
    hw_module_t const* module,
    char const* name,
    uint32_t device_version
)
{
    return  openDeviceLocked(device, module, i4OpenId, device_version);
}</pre>

<p>第11行, getPlatform函数用来加载libcam_platform.so，并获取PlatformEntry接口</p>
<p>第12行, 构造一个Cam1Device对象，并调用它的init函数</p>
<p>第13行, 获取camera device的操作集</p>
<h3>4.2 getPlatform函数分析</h3>
<pre>static PlatformEntry g_PlatformEntry;

IPlatform*
getHandleToPlatform()
{
    return &amp;g_PlatformEntry;
}

IPlatform*
CamDeviceManagerBase::
getPlatform()
{
    char const szModulePath[] = "libcam_platform.so";
    char const szEntrySymbol[] = "getHandleToPlatform";
    void* pfnEntry = NULL;
    IPlatform* pIPlatform = NULL;

    mpLibPlatform = ::dlopen(szModulePath, RTLD_NOW);
    pfnEntry = ::dlsym(mpLibPlatform, szEntrySymbol);
    pIPlatform = reinterpret_cast&lt;IPlatform*(*)()&gt;(pfnEntry)();
    gIPlatform = pIPlatform;

    return gIPlatform;
}</pre>
<p>第18行, 加载libcam_platform.so</p>
<p>第19 20行, 获取getHandleToPlatform函数入口，并调用，最后返回PlatformEntry接口</p>
<h3>4.3&nbsp;pPlatform-&gt;createCam1Device函数分析</h3>
<pre>NSCam::Cam1Device*
createCam1Device(
    String8 const   s8ClientAppMode,
    int32_t const   i4OpenId
)
{
    NSCam::Cam1Device* pdev = NULL;

    String8 const s8LibPath = String8::format("libcam.device1.so");
    void *handle = ::dlopen(s8LibPath.string(), RTLD_GLOBAL);

    String8 const s8CamDeviceInstFactory = String8::format("createCam1Device_Default");
    void* pCreateInstance = ::dlsym(handle, s8CamDeviceInstFactory.string());
    pdev = reinterpret_cast&lt;NSCam::Cam1Device* (*)(String8 const&amp;, int32_t const)&gt;
                    (pCreateInstance)(s8ClientAppMode, i4OpenId);

    pdev-&gt;initialize();
}

ICamDevice*
PlatformEntry::
createCam1Device( 
    char const*         szClientAppMode,
    int32_t const       i4OpenId
)
{
    return  ::createCam1Device(String8(szClientAppMode), i4OpenId);
}</pre>
<p>pPlatform-&gt;createCam1Device函数调用的是Cam1DeviceFactory.cpp里的createCam1Device函数</p>
<p>第10行, 加载libcam.device1.so</p>
<p>第12-15行, 获取createCam1Device_Default函数入口并调用</p>
<p>第17行,&nbsp;Cam1Device初始化</p>
<p>先来看createCam1Device_Default函数，以及类的继承关系</p>
<pre>class Cam1DeviceBase : public Cam1Device
{
}

class DefaultCam1Device : public Cam1DeviceBase
{
}

NSCam::Cam1Device*
createCam1Device_Default(
    String8 const&amp;          rDevName, 
    int32_t const           i4OpenId
)
{
    return new DefaultCam1Device(rDevName, i4OpenId);
}</pre>接着看DefaultCam1Device的构造函数

<pre>Cam1Device::
Cam1Device()
{   
    ::memset(&amp;mDevice, 0, sizeof(mDevice));
    mDevice.priv    = this;
    mDevice.common  = gHwDevice;
    mDevice.ops     = (camera_device_ops*)&amp;mDeviceOps;
    mDeviceOps      = gCameraDevOps;
}  

Cam1DeviceBase::
Cam1DeviceBase(
    String8 const&amp;          rDevName,
    int32_t const           i4OpenId
)
    : Cam1Device()
    , mDevName(rDevName)
    , mi4OpenId(i4OpenId)
{
    MY_LOGD("");
}

DefaultCam1Device::
DefaultCam1Device(
    String8 const&amp;          rDevName,
    int32_t const           i4OpenId
)
    : Cam1DeviceBase(rDevName, i4OpenId)
{
} </pre>删除了一些暂不关注的代码，DefaultCam1Device的构造函数会不断调用父类的构造函数，需要关注的是它的父类Cam1Device的构造函数。其中的gCameraDevOps结构体很重要，是Camera Device的操作集，预览、拍照、录像都是通过它来操作，来看下它的定义

<pre>static mtk_camera_device_ops const
gCameraDevOps =
{
    #define OPS(name) name: camera_##name

    {
        OPS(set_preview_window),
        OPS(set_callbacks), 
        OPS(enable_msg_type),
        OPS(disable_msg_type),
        OPS(msg_type_enabled), 
        OPS(start_preview),
        OPS(stop_preview), 
        OPS(preview_enabled), 
        OPS(store_meta_data_in_buffers),
        OPS(start_recording), 
        OPS(stop_recording), 
        OPS(recording_enabled),
        OPS(release_recording_frame),
        OPS(auto_focus), 
        OPS(cancel_auto_focus),
        OPS(take_picture),
        OPS(cancel_picture), 
        OPS(set_parameters), 
        OPS(get_parameters), 
        OPS(put_parameters), 
        OPS(send_command),
        OPS(release),
        OPS(dump)
    },
    OPS(mtk_set_callbacks),

    #undef  OPS
};</pre>
<p>回到createCam1Device函数，最后调用了pdev-&gt;initialize函数，这个函数过程比较复杂，在它的父类Cam1DeviceBase中实现</p>

<pre>bool
DefaultCam1Device::
onInit()
{
    //  (1) power on sensor
    if( pthread_create(&amp;mThreadHandle, NULL, doThreadInit, this) != 0 )
    {
        goto lbExit;
    }

    //  (2) Open 3A
    mpHal3a = NS3A::IHal3A::createInstance(
            NS3A::IHal3A::E_Camera_1,
            getOpenId(),
            LOG_TAG);

    //  (3) Init Base.
    if  ( ! Cam1DeviceBase::onInit() )
    {
        goto lbExit;
    }
}

status_t
Cam1DeviceBase::
initialize()
{
    onInit();
    return  OK;  
}</pre>initialize函数只是简单的回调了onInit函数，如注释所示，主要做了3件事情。其中(2)和(3)主要是初始化3A和CamClient，这两个这里暂时不会关注，所以暂时不进行分析。重点关注(1)，也就是doThreadInit函数

<pre>bool
DefaultCam1Device::
powerOnSensor()
{
    IHalSensorList* pHalSensorList = IHalSensorList::get();
    mpHalSensor = pHalSensorList-&gt;createSensor(USER_NAME, getOpenId());
    sensorIdx = getOpenId();
    if( !mpHalSensor-&gt;powerOn(USER_NAME, 1, &amp;sensorIdx) )
    {
        MY_LOGE("sensor power on failed: %d", sensorIdx);
        goto lbExit;
    }
    ......
}

void*   
DefaultCam1Device::
doThreadInit(void* arg)
{
    DefaultCam1Device* pSelf = reinterpret_cast&lt;DefaultCam1Device*&gt;(arg);
    pSelf-&gt;mRet = pSelf-&gt;powerOnSensor();
    pthread_exit(NULL);
    return NULL;
}</pre>doThreadInit函数只是回调自身的了powerOnSensor函数，而powerOnSensor函数先调用pHalSensorList-&gt;createSensor函数创建一个HalSensor实例，然后再调用它的PowerOn函数来开始相关的硬件操作，来看powerOn的实现

<pre>MBOOL
HalSensor::
powerOn(
    char const* szCallerName,
    MUINT const uCountOfIndex,
    MUINT const*pArrayOfIndex
)
{
    ......
    ret = mpSeninfDrv-&gt;init();
    ret = mpSensorDrv-&gt;init(sensorDev);
    ret = setTgPhase(sensorDev, pcEn);
    ret = setSensorIODrivingCurrent(sensorDev);
    ret = mpSensorDrv-&gt;open(sensorDev);
    ......
}</pre>powerOn函数比较长，这里暂时只关注SensorDrv的init和open函数<br>
<pre>MINT32
ImgSensorDrv::init(MINT32 sensorIdx)
{
    m_fdSensor = ::open("dev/kd_camera_hw", O_RDWR);

    //set driver
    ret = ioctl(m_fdSensor, KDIMGSENSORIOC_X_SET_DRIVER,sensorDrvInit);

    //init resolution
    pSensorResInfo[0] = &amp;m_SenosrResInfo[0];
    pSensorResInfo[1] = &amp;m_SenosrResInfo[1];
    ret = getResolution(pSensorResInfo);

    if(SENSOR_MAIN &amp; sensorIdx ) {
        sensorDevId = SENSOR_MAIN;

        FeatureParaLen = sizeof(MUINTPTR);
        ret = featureControl((CAMERA_DUAL_CAMERA_SENSOR_ENUM)sensorDevId, SENSOR_FEATURE_GET_PIXEL_CLOCK_FREQ,  (MUINT8*)&amp;FeaturePara32,(MUINT32*)&amp;FeatureParaLen);

        FeatureParaLen = sizeof(pFeaturePara16);
        ret = featureControl((CAMERA_DUAL_CAMERA_SENSOR_ENUM)sensorDevId, SENSOR_FEATURE_GET_PERIOD,  (MUINT8*)pFeaturePara16,(MUINT32*)&amp;FeatureParaLen);
    }
    ......
}

MINT32
ImgSensorDrv::open(MINT32 sensorIdx)
{
    MINT32 err = SENSOR_NO_ERROR;

    ......
    err = ioctl(m_fdSensor, KDIMGSENSORIOC_X_SET_CURRENT_SENSOR, &amp;sensorIdx);
    err = ioctl(m_fdSensor, KDIMGSENSORIOC_T_OPEN);

    return err;
}</pre>这两个函数逻辑比较简单，就是通过ioctl进入到kernel层来对sensor硬件进行初始化和获取硬件相关的信息。kernel层的代码暂不分析
<h3>4.4&nbsp;get_hw_device函数分析</h3>
<p>回到4.1的openDeviceLocked函数，最后调用了pDevice-&gt;get_hw_device函数，并将它的返回值赋给*device<br>
</p>
<pre>class Cam1Device : public ICamDevice
{
    virtual hw_device_t const*      get_hw_device() const { return &amp;mDevice.common; }
}</pre>
<p>这个函数很简单，就是获取4.3里面提到的mDevice，这个mDevice最终将被保存在frameworks层的CameraHardwareInterface.h的mDevice变量当中，以便日后访问</p>
<h1>5. 总结</h1>
<p>Camera打开流程的重点工作在4.3和4.4章节，也就是对Camera硬件进行初始化和将gCameraDevOps操作集返回给frameworks层。</p>
        <div class="pagebar">  </div>
        <p class="tags"><strong>Tags：</strong><a href="http://www.itdadao.com/tags/MTK-0.html" target="_blank">MTK</a> &nbsp; <a href="http://www.itdadao.com/tags/android-0.html" target="_blank">android</a> &nbsp; <a href="http://www.itdadao.com/tags/camera-0.html" target="_blank">camera</a> &nbsp; <a href="http://www.itdadao.com/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-0.html" target="_blank">源码分析</a> &nbsp; <a href="http://www.itdadao.com/tags/%E8%B0%83%E7%94%A8%E6%B5%81%E7%A8%8B-0.html" target="_blank">调用流程</a> &nbsp; <a href="http://www.itdadao.com/tags/-0.html" target="_blank"></a> </p>
        <div class="bdsharebuttonbox bdshare-button-style1-24" data-bd-bind="1496800073011"><a href="http://www.itdadao.com/articles/c15a674054p0.html#" class="bds_more" data-cmd="more"></a><a href="http://www.itdadao.com/articles/c15a674054p0.html#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="http://www.itdadao.com/articles/c15a674054p0.html#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="http://www.itdadao.com/articles/c15a674054p0.html#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a><a href="http://www.itdadao.com/articles/c15a674054p0.html#" class="bds_renren" data-cmd="renren" title="分享到人人网"></a><a href="http://www.itdadao.com/articles/c15a674054p0.html#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"1","bdSize":"24"},"share":{},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["qzone","tsina","tqq","renren","weixin"]}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
</div>
      <div class="sx mb15">
        <ul>
          <li class="fl">上一篇：<a href="http://www.itdadao.com/articles/c15a674053p0.html">Android 5.0 Camera系统源码分析(1)：CameraService启动流程</a> </li>
          <li class="fr ziyou">下一篇：<a href="http://www.itdadao.com/articles/c15a674055p0.html">线程常用接口</a> </li>
          <div class="clear"></div>
        </ul>
      </div>
      <div class="ad mb15 sjwu">
    <script src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/thea18.js.下载"></script><script async="" src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/adsbygoogle.js.下载"></script><ins class="adsbygoogle" style="display:inline-block;width:728px;height:90px" data-ad-client="ca-pub-8722128765990495" data-ad-slot="9159012222" data-adsbygoogle-status="done"><ins id="aswift_3_expand" style="display:inline-table;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:728px;background-color:transparent"><ins id="aswift_3_anchor" style="display:block;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:728px;background-color:transparent"><iframe width="728" height="90" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_3" name="aswift_3" style="left:0;position:absolute;top:0;width:728px;height:90px;" src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/saved_resource(2).html"></iframe></ins></ins></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
  </div>
  <div class="ad mb15 dnwu">
      </div>
      <div class="xg">
        <h2 class="ybbt">猜你喜欢</h2>
        <ul>
          <li><span>2017-06-07</span><i class="fa fa-caret-right"></i> <a href="http://www.itdadao.com/articles/c15a1415456p0.html">vue项目优化之按需加载组件-使用webpack require.ensure</a></li>

<li><span>2017-06-07</span><i class="fa fa-caret-right"></i> <a href="http://www.itdadao.com/articles/c18a1415455p0.html">Macs Able to Run macOS Sierra Remain Compatible With High Sierra</a></li>

<li><span>2017-06-07</span><i class="fa fa-caret-right"></i> <a href="http://www.itdadao.com/articles/c15a1415454p0.html">“海市蜃楼”般的逛街体验——VR全景智慧城市常诚</a></li>

<li><span>2017-06-07</span><i class="fa fa-caret-right"></i> <a href="http://www.itdadao.com/articles/c15a1415453p0.html">python中defaultdict的用法</a></li>

<li><span>2017-06-07</span><i class="fa fa-caret-right"></i> <a href="http://www.itdadao.com/articles/c15a1415452p0.html">解决 Ionic 浏览器跨域问题</a></li>

<li><span>2017-06-07</span><i class="fa fa-caret-right"></i> <a href="http://www.itdadao.com/articles/c15a1415451p0.html">配置管理工作流程</a></li>

<li><span>2017-06-07</span><i class="fa fa-caret-right"></i> <a href="http://www.itdadao.com/articles/c15a1415450p0.html">dpdk--helloworld源码+注释</a></li>

<li><span>2017-06-07</span><i class="fa fa-caret-right"></i> <a href="http://www.itdadao.com/articles/c15a1415449p0.html">windows环境下部署一个Jenkins工程</a></li>

<li><span>2017-06-07</span><i class="fa fa-caret-right"></i> <a href="http://www.itdadao.com/articles/c15a1415448p0.html">什么是Docker Volume?</a></li>

<li><span>2017-06-07</span><i class="fa fa-caret-right"></i> <a href="http://www.itdadao.com/articles/c18a1415447p0.html">我国终于掌握海底光缆自主制造技术：指标超外企</a></li>

        </ul>
      </div>
    </div>

    <div id="comments" class="bgb"> <span class="icon icon_comment" title="comment"></span>
      
      <!--评论框-->
      <div class="commentpost" id="comment">
<div class="ds-thread" data-category="15" data-thread-key="674054" data-title="Android 5.0 Camera系统源码分析(2)：Camera打开流程" id="ds-thread"><div id="ds-waiting"></div></div>
      </div>
    </div>

  </div>
  <div class="right fr sjwu">
  <!--dl class="function" id="divSearchPanel">
      <dt class="function_t">搜索</dt>
      <dd class="function_c">
        <div>
          <form onSubmit="return checkSearchForm()" method="post" name="searchform" action="http://www.itdadao.com/e/search/index.php" >
        <input type="hidden" value="title" name="show">
        <input type="hidden" value="1" name="tempid">
        <input type="hidden" value="news" name="tbname">
        <input name="mid" value="1" type="hidden">
        <input name="dopost" value="search" type="hidden">
            <input type="text" name="keyboard" size="11" />
            <input type="submit" value="搜索" />
          </form>
        </div>
      </dd>
    </dl-->
   <dl class="function">
      <dt style="display:none;"></dt>
      <dd class="function_c">
        <div>
          <script src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/thea16.js.下载"></script><script>  (function() {    var cx = '004183402591912962009:uah3-aabtfg';    var gcse = document.createElement('script');    gcse.type = 'text/javascript';    gcse.async = true;    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;    var s = document.getElementsByTagName('script')[0];    s.parentNode.insertBefore(gcse, s);  })();</script><gcse:search></gcse:search>
        </div>
      </dd>
    </dl> 
    <dl class="function">
      <dt style="display:none;"></dt>
      <dd class="function_c">
        <div>
          <script src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/thea13.js.下载"></script><script async="" src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/adsbygoogle.js.下载"></script><ins class="adsbygoogle" style="display:inline-block;width:300px;height:600px" data-ad-client="ca-pub-8722128765990495" data-ad-slot="8616858229" data-adsbygoogle-status="done"><ins id="aswift_4_expand" style="display:inline-table;border:none;height:600px;margin:0;padding:0;position:relative;visibility:visible;width:300px;background-color:transparent"><ins id="aswift_4_anchor" style="display:block;border:none;height:600px;margin:0;padding:0;position:relative;visibility:visible;width:300px;background-color:transparent"><iframe width="300" height="600" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_4" name="aswift_4" style="left:0;position:absolute;top:0;width:300px;height:600px;" src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/saved_resource(3).html"></iframe></ins></ins></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
        </div>
      </dd>
    </dl>
   
    <dl class="function">
      <dt style="display:none;"></dt>
      <dd class="function_c">
        <div>
          <script src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/thea14.js.下载"></script><script type="text/javascript">var jd_union_pid="464513571";var jd_union_euid="";</script><script type="text/javascript" src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/union.js.下载"></script><iframe scrolling="no" frameborder="0" width="300px" height="100%" src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/search.html"></iframe>
        </div>
      </dd>
    </dl>
    <!--dl class="function" id="divCatalog">
      <dt class="function_t">网站分类</dt>
      <dd class="function_c">
        <ul>
          <li><a class="current-menu-item" href="http://www.itdadao.com/category/c15p0.html"> 技术</a></li><li><a class="" href="http://www.itdadao.com/category/c18p0.html">新闻</a></li><li><a class="" href="http://www.itdadao.com/category/c19p0.html">源码</a></li><li><a class="" href="http://www.itdadao.com/category/c20p0.html">设计</a></li><li><a class="" href="http://www.itdadao.com/category/c21p0.html">创业</a></li><li><a class="" href="http://www.itdadao.com/category/c22p0.html">营销</a></li>        </ul>
      </dd>
    </dl-->
    <dl class="function" id="divTags">
      <dt class="function_t">标签列表</dt>
      <dd class="function_c">
        <ul>
              <li><a href="http://www.itdadao.com/e/tags/?tagname=Java" class="tags4">Java<span class="tag-count"> (85020)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=Android" class="tags9">Android<span class="tag-count"> (69622)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=JavaScript" class="tags8">JavaScript<span class="tag-count"> (57463)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=Linux" class="tags3">Linux<span class="tag-count"> (54280)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=C" class="tags4">C<span class="tag-count"> (49125)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=Python" class="tags3">Python<span class="tag-count"> (39890)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=%E7%A8%8B%E5%BA%8F%E5%91%98" class="tags8">程序员<span class="tag-count"> (31876)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=HTML" class="tags4">HTML<span class="tag-count"> (27406)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=iOS" class="tags1">iOS<span class="tag-count"> (25608)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=PHP" class="tags7">PHP<span class="tag-count"> (24533)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=CSS" class="tags1">CSS<span class="tag-count"> (22403)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=mysql" class="tags2">mysql<span class="tag-count"> (19510)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=%E8%B7%A8%E5%B9%B3%E5%8F%B0" class="tags7">跨平台<span class="tag-count"> (19142)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=%E6%95%B0%E6%8D%AE%E5%BA%93" class="tags1">数据库<span class="tag-count"> (18632)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=%E5%88%9B%E4%B8%9A" class="tags4">创业<span class="tag-count"> (16397)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=%E7%AE%97%E6%B3%95" class="tags2">算法<span class="tag-count"> (16107)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=iOSDeveloper" class="tags0">iOSDeveloper<span class="tag-count"> (15025)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=iOS%E5%BC%80%E5%8F%91" class="tags2">iOS开发<span class="tag-count"> (13980)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=CC" class="tags0">CC<span class="tag-count"> (13391)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=Oracle" class="tags0">Oracle<span class="tag-count"> (11715)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=Windows" class="tags4">Windows<span class="tag-count"> (11076)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=C%E8%AF%AD%E8%A8%80" class="tags8">C语言<span class="tag-count"> (11023)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=Objective-C" class="tags4">Objective-C<span class="tag-count"> (10791)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=android%E5%BC%80%E5%8F%91" class="tags1">android开发<span class="tag-count"> (10558)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=Shell" class="tags0">Shell<span class="tag-count"> (10298)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=%E9%A6%96%E9%A1%B5%E6%8A%95%E7%A8%BF" class="tags7">首页投稿<span class="tag-count"> (10196)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=Spring" class="tags1">Spring<span class="tag-count"> (9860)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=JS" class="tags5">JS<span class="tag-count"> (9590)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=LeetCode" class="tags9">LeetCode<span class="tag-count"> (9509)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84" class="tags2">数据结构<span class="tag-count"> (9033)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=Ubuntu" class="tags0">Ubuntu<span class="tag-count"> (8954)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=jQuery" class="tags3">jQuery<span class="tag-count"> (8739)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=acm" class="tags9">acm<span class="tag-count"> (7220)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0" class="tags8">机器学习<span class="tag-count"> (7203)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=SQL" class="tags0">SQL<span class="tag-count"> (6964)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=android%E7%9F%A5%E8%AF%86" class="tags0">android知识<span class="tag-count"> (6880)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=%E8%AE%BE%E8%AE%A1" class="tags9">设计<span class="tag-count"> (6846)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=Swift" class="tags9">Swift<span class="tag-count"> (6558)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F" class="tags7">设计模式<span class="tag-count"> (6500)</span></a></li>        <li><a href="http://www.itdadao.com/e/tags/?tagname=Hadoop" class="tags6">Hadoop<span class="tag-count"> (6292)</span></a></li>            </ul>
      </dd>
    </dl>
<dl class="function">
      <dt style="display:none;"></dt>
      <dd class="function_c">
        <div>
          <script src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/thea15.js.下载"></script><script async="" src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/adsbygoogle.js.下载"></script><ins class="adsbygoogle" style="display:inline-block;width:300px;height:600px" data-ad-client="ca-pub-8722128765990495" data-ad-slot="2166051820" data-adsbygoogle-status="done"><ins id="aswift_5_expand" style="display:inline-table;border:none;height:600px;margin:0;padding:0;position:relative;visibility:visible;width:300px;background-color:transparent"><ins id="aswift_5_anchor" style="display:block;border:none;height:600px;margin:0;padding:0;position:relative;visibility:visible;width:300px;background-color:transparent"><iframe width="300" height="600" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_5" name="aswift_5" style="left:0;position:absolute;top:0;width:300px;height:600px;" src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/saved_resource(4).html"></iframe></ins></ins></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
        </div>
      </dd>
    </dl>
   
  </div>
  <div class="clear"></div>
  <div class="ad mb15 sjwu">
    <script src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/thea12.js.下载"></script>
  </div>
  <div class="ad mb15 dnwu">
    <script async="" src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/adsbygoogle.js.下载"></script>
<ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8722128765990495" data-ad-slot="3450871422" data-ad-format="auto" data-adsbygoogle-status="done"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>  </div>
</div><ins class="adsbygoogle" data-adsbygoogle-status="done" style="display: none; width: auto; height: auto;"><ins id="aswift_0_expand" style="display:inline-table;border:none;height:0px;margin:0;padding:0;position:relative;visibility:visible;width:0px;background-color:transparent"><ins id="aswift_0_anchor" style="display:block;border:none;height:0px;margin:0;padding:0;position:relative;visibility:visible;width:0px;background-color:transparent"><iframe width="0" height="0" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_0" name="aswift_0" style="left:0;position:absolute;top:0;width:0px;height:0px;" src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/saved_resource(5).html"></iframe></ins></ins></ins>
<div class="footer">
  <div class="zh">
    <p>Powered By <a href="http://www.itdadao.com/" title="IT大道" target="_blank">IT大道</a> | <a href="http://www.itdadao.com/sitemap.xml" target="_blank">站点地图</a></p>
    蜀ICP备11026280号-5 <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?8c22300041ade6406bfe3b4b4654b86b";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-39740456-2', 'auto');
  ga('send', 'pageview');

</script></div>
</div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"itdadao"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>

<iframe frameborder="0" id="bdSharePopup_selectshare1496800073015bg" class="bdselect_share_bg" style="display:none;" src="./Android 5.0 Camera系统源码分析(2)：Camera打开流程-IT大道_files/saved_resource(6).html"></iframe><div id="bdSharePopup_selectshare1496800073015box" style="display: none;" share-type="selectshare" class="bdselect_share_box" data-bd-bind="1496800073015"><div class="selectshare-mod-triangle"><div class="triangle-border"></div><div class="triangle-inset"></div></div><div class="bdselect_share_head"><span>分享到</span><a href="http://www.baidu.com/s?wd=&amp;tn=SE_hldp08010_vurs2xrp" class="bdselect_share_dialog_search" target="_blank"><i class="bdselect_share_dialog_search_i"></i><span class="bdselect_share_dialog_search_span">百度一下</span></a><a class="bdselect_share_dialog_close"></a></div><div class="bdselect_share_content"><ul class="bdselect_share_list bdshare-button-style1-24"><div class="bdselect_share_partners"><a href="http://www.itdadao.com/articles/c15a674054p0.html#" class="bds_qzone" data-cmd="qzone"></a><a href="http://www.itdadao.com/articles/c15a674054p0.html#" class="bds_tsina" data-cmd="tsina"></a><a href="http://www.itdadao.com/articles/c15a674054p0.html#" class="bds_tqq" data-cmd="tqq"></a><a href="http://www.itdadao.com/articles/c15a674054p0.html#" class="bds_renren" data-cmd="renren"></a><a href="http://www.itdadao.com/articles/c15a674054p0.html#" class="bds_weixin" data-cmd="weixin"></a></div><a href="http://www.itdadao.com/articles/c15a674054p0.html#" class="bds_more" data-cmd="more"></a></ul></div></div><div id="bdimgshare_1496800073019" class="sr-bdimgshare sr-bdimgshare-list sr-bdimgshare-16 sr-bdimgshare-black" style="height: 36px; line-height: 26px; font-size: 12px; position: absolute; top: 7289px; left: 335.5px; width: 818px; display: none;" data-bd-bind="1496800073019"><div class="bdimgshare-bg"></div><div class="bdimgshare-content bdsharebuttonbox bdshare-button-style0-16"><label class="bdimgshare-lbl">分享到：</label><a href="http://www.itdadao.com/articles/c15a674054p0.html#" onclick="return false;" class="bds_qzone" data-cmd="qzone" hidefocus=""></a><a href="http://www.itdadao.com/articles/c15a674054p0.html#" onclick="return false;" class="bds_tsina" data-cmd="tsina" hidefocus=""></a><a href="http://www.itdadao.com/articles/c15a674054p0.html#" onclick="return false;" class="bds_tqq" data-cmd="tqq" hidefocus=""></a><a href="http://www.itdadao.com/articles/c15a674054p0.html#" onclick="return false;" class="bds_renren" data-cmd="renren" hidefocus=""></a><a href="http://www.itdadao.com/articles/c15a674054p0.html#" onclick="return false;" class="bds_weixin" data-cmd="weixin" hidefocus=""></a><a href="http://www.itdadao.com/articles/c15a674054p0.html#" onclick="return false;" class="bds_more" data-cmd="more" hidefocus=""></a></div></div></body></html>